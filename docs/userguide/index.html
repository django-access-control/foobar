<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.85.0" /><META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>User guide | ðŸ”’ Django access control</title><meta property="og:title" content="User guide" />
<meta property="og:description" content="Here is the quick overview how to use the framework.
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/docs/userguide/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2021-06-22T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-07-10T01:20:10+03:00" />

<meta itemprop="name" content="User guide">
<meta itemprop="description" content="Here is the quick overview how to use the framework.
"><meta itemprop="datePublished" content="2021-06-22T00:00:00+00:00" />
<meta itemprop="dateModified" content="2021-07-10T01:20:10+03:00" />
<meta itemprop="wordCount" content="1017">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="User guide"/>
<meta name="twitter:description" content="Here is the quick overview how to use the framework.
"/>





<link rel="preload" href="/scss/main.min.23de4c98e47cec9bdeb7760e526985f239bf3e022d174b9e947d3fdfe8764b0c.css" as="style">
<link href="/scss/main.min.23de4c98e47cec9bdeb7760e526985f239bf3e022d174b9e947d3fdfe8764b0c.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>


<style>
    .nav-link[href="/docs/"] {
        visibility: hidden !important;
    }
    .td-page-meta > a:nth-child(1), .td-page-meta > a:nth-child(2) {
        visibility: hidden;
    }
</style>

  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"></span><span class="text-uppercase font-weight-bold">ðŸ”’ Django access control</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link active" href="/docs/" ><span class="active">Documentation</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">



<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this siteâ€¦"
  aria-label="Search this siteâ€¦"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.53b202b5a69d7aa92ad1ab69b1346b85.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <form class="td-sidebar__search d-flex align-items-center d-lg-none">
    



<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this siteâ€¦"
  aria-label="Search this siteâ€¦"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.53b202b5a69d7aa92ad1ab69b1346b85.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>


    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Documentation</a>
  </li>
  <ul>
    <li class="collapse show" id="docs">
      
      
      
      
        
          
          
          <a class="td-sidebar-link td-sidebar-link__page  active" id="m-docsuserguide" href="/docs/userguide/">User guide</a>
        
      
      
      
        
          
          
          <a class="td-sidebar-link td-sidebar-link__page " id="m-docstheory" href="/docs/theory/">Theory</a>
        
      
      
      
        
          
          
          <a class="td-sidebar-link td-sidebar-link__page " id="m-docssample-project" href="/docs/sample-project/">The sample project</a>
        
      
      
      
        
          
          
          <a class="td-sidebar-link td-sidebar-link__page " id="m-docssecurity-notice" href="/docs/security-notice/">Notes on security</a>
        
      
      
      
        
          
          
          <a class="td-sidebar-link td-sidebar-link__page " id="m-docssimilar-projects" href="/docs/similar-projects/">Similar projects</a>
        
      
      
      
        
          
          
          <a class="td-sidebar-link td-sidebar-link__page " id="m-docschangelog" href="/docs/changelog/">Changelog</a>
        
      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            






<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">











<a href="https://github.com/django-access-control/django-access-control.github.io/edit/master/content/en/docs/userguide.md" target="_blank"><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/django-access-control/django-access-control.github.io/new/master/content/en/docs/userguide.md?filename=change-me.md&amp;value=---%0Atitle%3A&#43;%22Long&#43;Page&#43;Title%22%0AlinkTitle%3A&#43;%22Short&#43;Nav&#43;Title%22%0Aweight%3A&#43;100%0Adescription%3A&#43;%3E-%0A&#43;&#43;&#43;&#43;&#43;Page&#43;description&#43;for&#43;heading&#43;and&#43;indexes.%0A---%0A%0A%23%23&#43;Heading%0A%0AEdit&#43;this&#43;template&#43;to&#43;create&#43;your&#43;new&#43;page.%0A%0A%2A&#43;Give&#43;it&#43;a&#43;good&#43;name%2C&#43;ending&#43;in&#43;%60.md%60&#43;-&#43;e.g.&#43;%60getting-started.md%60%0A%2A&#43;Edit&#43;the&#43;%22front&#43;matter%22&#43;section&#43;at&#43;the&#43;top&#43;of&#43;the&#43;page&#43;%28weight&#43;controls&#43;how&#43;its&#43;ordered&#43;amongst&#43;other&#43;pages&#43;in&#43;the&#43;same&#43;directory%3B&#43;lowest&#43;number&#43;first%29.%0A%2A&#43;Add&#43;a&#43;good&#43;commit&#43;message&#43;at&#43;the&#43;bottom&#43;of&#43;the&#43;page&#43;%28%3C80&#43;characters%3B&#43;use&#43;the&#43;extended&#43;description&#43;field&#43;for&#43;more&#43;detail%29.%0A%2A&#43;Create&#43;a&#43;new&#43;branch&#43;so&#43;you&#43;can&#43;preview&#43;your&#43;new&#43;file&#43;and&#43;request&#43;a&#43;review&#43;via&#43;Pull&#43;Request.%0A" target="_blank"><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/django-access-control/django-access-control.github.io/issues/new?title=User%20guide" target="_blank"><i class="fab fa-github fa-fw"></i> Create documentation issue</a>


<a href="https://github.com/django-access-control/django-access-control/issues/new" target="_blank"><i class="fas fa-tasks fa-fw"></i> Create project issue</a>



<a id="print" href="/docs/_print/"><i class="fa fa-print fa-fw"></i> Print entire section</a>



</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#the-theory">The theory</a></li>
    <li><a href="#installation">Installation</a></li>
    <li><a href="#implementing-access-control">Implementing access control</a>
      <ul>
        <li><a href="#table-level-permissions">Table level permissions</a></li>
        <li><a href="#row-level-permissions">Row level permissions</a></li>
        <li><a href="#colum-level-permissions">Colum level permissions</a></li>
      </ul>
    </li>
    <li><a href="#the-view-layer">The view layer</a></li>
  </ul>
</nav>



          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		







<li class="breadcrumb-item" >
	<a href="/docs/">Documentation</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="/docs/userguide/">User guide</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<h1>User guide</h1>
    <div class="lead">Here is the quick overview how to use the framework.</div>
	       
	<h2 id="the-theory">The theory</h2>
<blockquote>
Experience by itself teaches nothing...<br>
Without theory, experience has no meaning.<br>
Without theory, one has no questions to ask.<br>
Hence without theory there is no learning.<br>
~ <cite>W. Edwards Deming</cite>
</blockquote>
<p>Yes, theories can be boring. However, we need to establish some common vocabulary before we can move forward. Therefore, please review the <a href="/docs/theory/">theory</a> section before heading on to practical stuff.</p>
<h2 id="installation">Installation</h2>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">pip install django-access-control
</code></pre></div><p>That&rsquo;s it. No need to add anything to <code>INSTALLED_APPS</code>, configure the <code>AUTHENTICATION_BACKENDS</code> or inherit from our <code>User</code> model. Also, we do not create any objects in your database.</p>
<h2 id="implementing-access-control">Implementing access control</h2>
<p>Different systems need different granularity when it comes to access control.
Let&rsquo;s go over some examples moving from more broad categories to more specific ones.</p>
<p>We will implement a simplified version of <a href="/docs/example-project/">the example project</a>: a Q&amp;A site.
Let&rsquo;s create the model <code>Question</code> as follows:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">django.db</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">models</span>

<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Question</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">models</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">title</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">models</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">CharField</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">max_length</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">body</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">models</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">TextField</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">author</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">models</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ForeignKey</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">settings</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">AUTH_USER_MODEL</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">on_delete</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">models</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">PROTECT</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">is_published</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">models</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">BooleanField</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#000">objects</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">QuestionQuerySet</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">as_manager</span><span style="color:#000;font-weight:bold">()</span>

    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__str__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">title</span>
</code></pre></div><p>Above the model, let&rsquo;s add the query set:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">django_access_control.querysets</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">ConfidentialQuerySet</span>

<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">QuestionQuerySet</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ConfidentialQuerySet</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">pass</span>
</code></pre></div><p>Finally, let&rsquo;s register oue model to the DJango admin site:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">django.contrib</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">admin</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">django_access_control.admin</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">ConfidentialModelAdmin</span>

<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">questions.models</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Question</span>


<span style="color:#5c35cc;font-weight:bold">@admin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">register</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Question</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">QuestionAdmin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ConfidentialModelAdmin</span><span style="color:#000;font-weight:bold">):</span>

    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">save_model</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">request</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">obj</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">form</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">change</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#4e9a06">&#34;&#34;&#34;
</span><span style="color:#4e9a06">        Automatically fill `question.author` with the current user
</span><span style="color:#4e9a06">        when a new question is added.
</span><span style="color:#4e9a06">        &#34;&#34;&#34;</span>
        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#204a87;font-weight:bold">not</span> <span style="color:#000">change</span><span style="color:#000;font-weight:bold">:</span>  <span style="color:#8f5902;font-style:italic"># `not change` means the obj is added, not modified</span>
            <span style="color:#000">obj</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">author</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">request</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">user</span>
        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">save_model</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">request</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">obj</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">form</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">change</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Now everything should work in the same way as it normal would since our permission policy defaults are the same as Django&rsquo;s to make it more intuitive to use.</p>
<h3 id="table-level-permissions">Table level permissions</h3>
<p>There are four methods to configure table level permissions. Here they are with their default implementations:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">has_table_wide_add_permission</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AbstractUser</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">bool</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_superuser</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#000">has_permission</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">user</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;add&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">model</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">has_table_wide_view_permission</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AbstractUser</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">bool</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_superuser</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#000">has_permission</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">user</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;view&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">model</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">has_table_wide_change_permission</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AbstractUser</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">bool</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_superuser</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#000">has_permission</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">user</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;change&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">model</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">has_table_wide_delete_permission</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AbstractUser</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">bool</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_superuser</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#000">has_permission</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">user</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;delete&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">model</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Let&rsquo;s override one of them to give every logged in user the right to add questions:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">has_table_wide_add_permission</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AbstractUser</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">bool</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_authenticated</span>

</code></pre></div><h3 id="row-level-permissions">Row level permissions</h3>
<p>If the user has some permission for the entire table, it will apply to all the rows. The methods below will give you more granular control by allowing to you give extra permission to a limited number or rows.</p>
<p>The methods you can use are:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">rows_with_extra_view_permission</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AbstractUser</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">QuerySet</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">none</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">rows_with_extra_change_permission</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AbstractUser</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">QuerySet</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">none</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">rows_with_extra_delete_permission</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AbstractUser</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">QuerySet</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">none</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>By default they do not grant permission to any rows. Let&rsquo;s adjust the <code>view</code> permissions so that</p>
<ul>
<li>everybody can see published questions</li>
<li>staff members can see all questions</li>
<li>authors can see their questions even if they are not published</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">rows_with_extra_view_permission</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AbstractUser</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">QuerySet</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">Question</span><span style="color:#000;font-weight:bold">]:</span>
    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_staff</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">is_published</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">|</span> \
            <span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">author</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">user</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_authenticated</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">none</span><span style="color:#000;font-weight:bold">())</span>
</code></pre></div><p>On the last line <code>|</code> is the bitwise OR operator which returns the union of the two querysets (this is why we learned set theory at school ðŸ™‚ ).</p>
<p>The <code>if user.is_authenticated else</code> is necessary because if the user is not logged in, they are represented by an <a href="https://docs.djangoproject.com/en/dev/ref/contrib/auth/#django.contrib.auth.models.AnonymousUser"><code>AnonymousUser</code></a> which has a more limited interface compared to the regular <code>User</code>. Without this check, <code>AnonymousUser</code> would be passed to <code>self.filter(author=user)</code> which would result in an exception in the lower layers (which was pretty hard to track down&hellip;).</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Be mindful!</h4>

    <p>There are two methods with very similar names:</p>
<ul>
<li><code>rows_with_extra_view_permission</code></li>
<li><code>rows_with_view_permission</code></li>
</ul>
<p>You should override the first one. The later on will use <code>rows_with_extra_view_permission</code> as well as <code>has_table_wide_view_permission</code> to combine together all the rows the user can view. That method might be handy if you need to fetch all the rows in your view layer. It is also internally used in the Django admin integration.</p>


</div>

<h3 id="colum-level-permissions">Colum level permissions</h3>
<p>There are three methods for fine-tuning field level permissions:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#5c35cc;font-weight:bold">@classmethod</span>
<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">addable_fields</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">cls</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AbstractUser</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">FrozenSet</span><span style="color:#000;font-weight:bold">[</span><span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">]:</span>
    <span style="color:#4e9a06">&#34;&#34;&#34;
</span><span style="color:#4e9a06">    Control which fields the user can specify when creating a new object (row).
</span><span style="color:#4e9a06">    NB! Make sure that all not nullable fields that are not specified here
</span><span style="color:#4e9a06">    would be populated automatically
</span><span style="color:#4e9a06">    to prevent IntegrityError for the database.
</span><span style="color:#4e9a06">    &#34;&#34;&#34;</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87">frozenset</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">all_field_names</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">cls</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">model</span><span style="color:#000;font-weight:bold">))</span>

<span style="color:#5c35cc;font-weight:bold">@staticmethod</span>
<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">viewable_fields</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">user</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AbstractUser</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">obj</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">FrozenSet</span><span style="color:#000;font-weight:bold">[</span><span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">]:</span>
    <span style="color:#4e9a06">&#34;&#34;&#34;
</span><span style="color:#4e9a06">    Control which wields the user can view.
</span><span style="color:#4e9a06">    &#34;&#34;&#34;</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87">frozenset</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">all_field_names</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">))</span>

<span style="color:#5c35cc;font-weight:bold">@staticmethod</span>
<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">changeable_fields</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">user</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AbstractUser</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">obj</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">FrozenSet</span><span style="color:#000;font-weight:bold">[</span><span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">]:</span>
    <span style="color:#4e9a06">&#34;&#34;&#34;
</span><span style="color:#4e9a06">    Control which wields the user can edit.
</span><span style="color:#4e9a06">    &#34;&#34;&#34;</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87">frozenset</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">all_field_names</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">))</span>
</code></pre></div><p>By default the user has access to all the fields. Let&rsquo;s update it so that</p>
<ul>
<li>the question authors can update the <code>body</code> of the question</li>
<li>stuff members can publish and unpublish questions</li>
<li>superusers can do everything</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#5c35cc;font-weight:bold">@staticmethod</span>
<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">changeable_fields</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">user</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AbstractUser</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">obj</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">Question</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">FrozenSet</span><span style="color:#000;font-weight:bold">[</span><span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">]:</span>
    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_superuser</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87">frozenset</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">all_field_names</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">))</span>
    <span style="color:#000">fields</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">frozenset</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">obj</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">author</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">user</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">fields</span> <span style="color:#ce5c00;font-weight:bold">|=</span> <span style="color:#204a87">frozenset</span><span style="color:#000;font-weight:bold">({</span><span style="color:#4e9a06">&#34;body&#34;</span><span style="color:#000;font-weight:bold">})</span>
    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">user</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">is_staff</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">fields</span> <span style="color:#ce5c00;font-weight:bold">|=</span> <span style="color:#204a87">frozenset</span><span style="color:#000;font-weight:bold">({</span><span style="color:#4e9a06">&#34;is_published&#34;</span><span style="color:#000;font-weight:bold">})</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">fields</span>
</code></pre></div>

<div class="alert alert-primary" role="alert">


    We use <code>frozenset</code> &ndash; an immutable version of the regular <code>set</code> &ndash; because immutability greatly reduces the risk of human error (such as passing the mutable set to a function as an argument, modifying it in the function and not being aware that the changes will also influence other places where the same set is used). And mistakes in the security layer can be costly&hellip;

</div>

<h2 id="the-view-layer">The view layer</h2>
<p>Django Access Control provides out-of-the-box integration with the Django admin site through the <code>ConfidentialModelAdmin</code> class. You can use its implementation as an example for your custom views and forms as well.</p>
<p>In addition to the methods already discussed above, <code>ConfidentialQuerySet</code> provides some special methods intended to be used in the view layer:</p>
<ul>
<li><code>rows_with_view_permission(self, user: AbstractUser) -&gt; QuerySet</code></li>
<li><code>rows_with_change_permission(self, user: AbstractUser) -&gt; QuerySet</code></li>
<li><code>rows_with_delete_permission(self, user: AbstractUser) -&gt; QuerySet</code></li>
<li><code>rows_with_some_permission(self, user: AbstractUser) -&gt; QuerySet</code> &ndash; returns all rows for which the user has at least some kind of permissions</li>
<li><code>has_some_permissions(self, user: AbstractUser) -&gt; bool</code> &ndash; indicates whether the user has any permission to any instance of the model</li>
<li><code>contains(self, obj: Model) -&gt; bool</code> &ndash; indicates whether the given queryset contains the <code>obj</code></li>
</ul>


<div class="alert alert-warning" role="alert">


    Django Access Control cannot guard you from everything.<br>
Please refer to <a href="/docs/security-notice/">the security notice</a> for further details.

</div>


	
	
	<div class="text-muted mt-5 pt-3 border-top">Last modified July 10, 2021: <a  href="https://github.com/django-access-control/django-access-control.github.io/commit/9c461624b246890807d1c214ae5bc8a097e61357">Working on homepage (9c46162)</a>
</div>
</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        
        
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>













<script src="/js/main.min.63db3e552bd0543be17ce4a79a18b744e9cb72256bec42b540e3ab0cd43722d0.js" integrity="sha256-Y9s&#43;VSvQVDvhfOSnmhi3ROnLciVr7EK1QOOrDNQ3ItA=" crossorigin="anonymous"></script>




  </body>
</html>